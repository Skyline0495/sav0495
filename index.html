<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥–æ–≤—ã–π —Ç–∞–π–º–µ—Ä</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f5f5f5;
      padding: 40px;
    }
    input {
      padding: 10px;
      margin: 5px;
      font-size: 18px;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 10px;
    }
    .timer {
      font-size: 48px;
      margin-top: 30px;
    }
    .round {
      font-size: 32px;
      margin-top: 10px;
    }
    #hostControls {
      margin: 20px 0;
      padding: 15px;
      background: #e9e9e9;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h1>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥–æ–≤—ã–π —Ç–∞–π–º–µ—Ä</h1>
  
  <div id="hostControls">
    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤: <input type="number" id="rounds" value="5"></label><br>
    <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—É–Ω–¥–∞ (–º–∏–Ω:—Å–µ–∫): <input type="text" id="duration" value="5:00"></label><br>
    <button onclick="startTimer()">–°—Ç–∞—Ä—Ç (–¢–æ–ª—å–∫–æ –¥–ª—è —Ö–æ—Å—Ç–∞)</button>
  </div>

  <div class="timer" id="timePassed">‚åõ 00:00</div>
  <div class="round" id="roundStatus">üéØ –†–∞—É–Ω–¥: -</div>
  <div class="round" id="timeToNext">‚è≥ –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ: -</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-database.js"></script>
  
  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é!)
    
const firebaseConfig = {
  apiKey: "AIzaSyD6cDgXRTBmXsjWLsaDgFvGh2C1H6DSHgA",
  authDomain: "supertimer-dc53c.firebaseapp.com",
  databaseURL: "https://supertimer-dc53c-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "supertimer-dc53c",
  storageBucket: "supertimer-dc53c.appspot.com",
  messagingSenderId: "624576534672",
  appId: "1:624576534672:web:5eae9e01aa1ba8114c6015",
  measurementId: "G-RFT5BGWRB3"
};


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let startTime;
    let interval;
    let totalRounds = 5;
    let roundDuration = 300;
    let isHost = window.location.hash === '#host';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ —Ö–æ—Å—Ç—É
    if (!isHost) {
      document.getElementById('hostControls').style.display = 'none';
    }

    function startTimer() {
      const roundsInput = document.getElementById('rounds').value;
      const durationInput = document.getElementById('duration').value;

      totalRounds = parseInt(roundsInput);
      const [min, sec] = durationInput.split(':').map(Number);
      roundDuration = min * 60 + sec;

      const timerData = {
        startTime: Date.now(),
        totalRounds: totalRounds,
        roundDuration: roundDuration
      };

      // –•–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      database.ref('timer').set(timerData);
    }

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Firebase
    database.ref('timer').on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        startTime = new Date(data.startTime);
        totalRounds = data.totalRounds;
        roundDuration = data.roundDuration;
        
        clearInterval(interval);
        interval = setInterval(updateTimer, 500);
      }
    });

    function updateTimer() {
      const now = new Date();
      const secondsPassed = Math.floor((now - startTime) / 1000);
      const currentRound = Math.min(Math.floor(secondsPassed / roundDuration) + 1, totalRounds);
      const timeInCurrentRound = secondsPassed % roundDuration;
      const timeLeft = roundDuration - timeInCurrentRound;

      const minPassed = Math.floor(secondsPassed / 60).toString().padStart(2, '0');
      const secPassed = (secondsPassed % 60).toString().padStart(2, '0');
      document.getElementById('timePassed').textContent = `‚åõ ${minPassed}:${secPassed}`;
      document.getElementById('roundStatus').textContent = currentRound > totalRounds
        ? `‚úÖ –í—Å–µ —Ä–∞—É–Ω–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã`
        : `üéØ –†–∞—É–Ω–¥ ${currentRound} –∏–∑ ${totalRounds}`;

      if (currentRound <= totalRounds) {
        const minLeft = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const secLeft = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('timeToNext').textContent = `‚è≥ –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ: ${minLeft}:${secLeft}`;
      } else {
        document.getElementById('timeToNext').textContent = `‚è≥ –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ: -`;
      }
    }
  </script>
</body>
</html>